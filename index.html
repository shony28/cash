<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—É—Ä—Å–∏ –≤–∞–ª—é—Ç</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ffffff 0%, #ffffff 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .last-update {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .loading {
            text-align: center;
            color: white;
            font-size: 1.2rem;
            margin: 50px 0;
        }

        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .table-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            overflow-x: auto;
            position: relative;
        }

  

        .rates-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1.1rem;
            margin-top: 10px;
        }

        .rates-table thead {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .rates-table th {
            padding: 18px 15px;
            text-align: center;
            font-weight: 600;
            font-size: 1.2rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .rates-table th:first-child {
            text-align: left;
            border-radius: 10px 0 0 0;
        }

        .rates-table th:last-child {
            border-radius: 0 10px 0 0;
        }

        .rates-table td {
            padding: 16px 15px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .rates-table td:first-child {
            text-align: left;
            font-weight: 600;
            color: #333;
            font-size: 1.15rem;
        }

        .rates-table tbody tr {
            transition: all 0.3s ease;
        }

        .rates-table tbody tr:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .rates-table tbody tr:last-child td {
            border-bottom: none;
        }

        .buy-rate {
            /*background: linear-gradient(135deg, #4CAF50, #45a049);*/
            color: #333333;
            border-radius: 8px;
            padding: 8px 12px;
            font-weight: bold;
            display: inline-block;
            min-width: 80px;
            box-shadow: 0 2px 8px rgba(173, 173, 173, 0.3);
        }

        .sell-rate {
            /*background: linear-gradient(135deg, #f44336, #d32f2f);*/
            color: #333333;
            border-radius: 8px;
            padding: 8px 12px;
            font-weight: bold;
            display: inline-block;
            min-width: 80px;
            box-shadow: 0 2px 8px rgba(173, 173, 173, 0.3);
        }

        .error-message {
            background: rgba(244, 67, 54, 0.9);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        /* –ú–æ–±—ñ–ª—å–Ω–∞ –∞–¥–∞–ø—Ç–∞—Ü—ñ—è */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .table-container {
                padding: 20px;
                margin: 0 -10px;
            }

            .rates-table {
                font-size: 1rem;
            }

            .rates-table th {
                padding: 12px 8px;
                font-size: 1rem;
            }

            .rates-table td {
                padding: 12px 8px;
            }

            .rates-table td:first-child {
                font-size: 1rem;
            }

            .buy-rate, .sell-rate {
                padding: 6px 8px;
                font-size: 0.9rem;
                min-width: 60px;
            }

            body {
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .table-container {
                padding: 15px;
            }

            .rates-table th {
                padding: 10px 5px;
                font-size: 0.9rem;
            }

            .rates-table td {
                padding: 10px 5px;
            }

            .rates-table td:first-child {
                font-size: 0.95rem;
            }

            .buy-rate, .sell-rate {
                padding: 5px 6px;
                font-size: 0.8rem;
                min-width: 50px;
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—ó —Ç–∞–±–ª–∏—Ü—ñ –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö –µ–∫—Ä–∞–Ω–∞—Ö */
        @media (max-width: 600px) {
            .rates-table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
            
            .rates-table thead,
            .rates-table tbody,
            .rates-table th,
            .rates-table td,
            .rates-table tr {
                display: block;
            }
            
            .rates-table thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            
            .rates-table tr {
                border: 1px solid #ccc;
                margin-bottom: 10px;
                padding: 10px;
                border-radius: 8px;
                background: white;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            }
            
            .rates-table td {
                border: none !important;
                position: relative;
                padding-left: 50% !important;
                text-align: right !important;
                white-space: normal;
            }
            
            .rates-table td:before {
                content: attr(data-label) ": ";
                position: absolute;
                left: 6px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                font-weight: bold;
                color: #333;
            }
            
            .rates-table td:first-child {
                text-align: center !important;
                font-size: 1.2rem !important;
                padding-left: 0 !important;
                margin-bottom: 10px;
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                border-radius: 5px;
                padding: 10px !important;
            }
            
            .rates-table td:first-child:before {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí± –ö—É—Ä—Å–∏ –≤–∞–ª—é—Ç</h1>
            <div class="last-update" id="lastUpdate">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
        </div>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <div>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç...</div>
        </div>

        <div id="error" class="error-message" style="display: none;">
            <h3>‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</h3>
            <p>–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ –∑ Google –¢–∞–±–ª–∏—Ü—ñ. –°–ø—Ä–æ–±—É–π—Ç–µ –æ–Ω–æ–≤–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É.</p>
        </div>

        <div id="ratesContainer" class="table-container" style="display: none;">
            <table class="rates-table" id="ratesTable">
                <thead>
                    <tr>
                        <th>–í–∞–ª—é—Ç–∞</th>
                        <th>–ö—É–ø—ñ–≤–ª—è</th>
                        <th>–ü—Ä–æ–¥–∞–∂</th>
                    </tr>
                </thead>
                <tbody id="ratesTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏
        const SPREADSHEET_ID = '1wS170m_02ieAf20uu8iRPgFdZrZS_2-ivwhR0Cr2Nds';
        const SHEET_NAME = 'exchange';
        const AUTO_REFRESH_INTERVAL = 30; // –Ü–Ω—Ç–µ—Ä–≤–∞–ª –∞–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤ —Ö–≤–∏–ª–∏–Ω–∞—Ö (0 - –≤–∏–º–∫–Ω—É—Ç–∏)

        let ratesData = [];

        async function loadRates() {
            const loadingEl = document.getElementById('loading');
            const errorEl = document.getElementById('error');
            const containerEl = document.getElementById('ratesContainer');
            const lastUpdateEl = document.getElementById('lastUpdate');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            loadingEl.style.display = 'block';
            errorEl.style.display = 'none';
            containerEl.style.display = 'none';

            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º CORS proxy –¥–ª—è –æ–±—Ö–æ–¥–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
                const proxyUrl = 'https://api.allorigins.win/raw?url=';
                const targetUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?sheet=${SHEET_NAME}&range=A2:C&tqx=out:json`;
                const fullUrl = proxyUrl + encodeURIComponent(targetUrl);

                const response = await fetch(fullUrl);
                const text = await response.text();
                
                // –ü–∞—Ä—Å–∏–º JSON –∏–∑ Google Visualization API (—É–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å –∏ —Å—É—Ñ—Ñ–∏–∫—Å)
                let jsonText = text.trim();
                if (jsonText.startsWith('/*O_o*/\ngoogle.visualization.Query.setResponse(')) {
                    jsonText = jsonText.substring(47); // —É–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å
                    jsonText = jsonText.substring(0, jsonText.length - 2); // —É–±–∏—Ä–∞–µ–º ");"
                }
                
                const jsonData = JSON.parse(jsonText);
                
                if (!jsonData.table || !jsonData.table.rows) {
                    throw new Error('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–∏—Ö –∞–±–æ —Ç–∞–±–ª–∏—Ü—è –ø—É—Å—Ç–∞');
                }

                const rows = jsonData.table.rows;
                ratesData = [];

                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                for (let i = 0; i < rows.length; i++) {
                    const row = rows[i];
                    if (row.c && row.c.length >= 3) {
                        const currency = row.c[0] ? (row.c[0].v || '') : '';
                        const buyRate = row.c[1] ? (row.c[1].v || '') : '';
                        const sellRate = row.c[2] ? (row.c[2].v || '') : '';

                        if (currency && buyRate !== '' && sellRate !== '') {
                            ratesData.push({
                                currency: currency.toString(),
                                buy: buyRate.toString(),
                                sell: sellRate.toString()
                            });
                        }
                    }
                }

                if (ratesData.length === 0) {
                    throw new Error('–î–∞–Ω—ñ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ —É —Ç–∞–±–ª–∏—Ü—ñ —î –¥–∞–Ω—ñ –ø–æ—á–∏–Ω–∞—é—á–∏ –∑ —Ä—è–¥–∫–∞ 2');
                }

                displayRates();
                loadingEl.style.display = 'none';
                containerEl.style.display = 'block';
                lastUpdateEl.textContent = `–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: ${new Date().toLocaleString('uk-UA')}`;

            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:', error);
                loadingEl.style.display = 'none';
                errorEl.style.display = 'block';
                errorEl.innerHTML = `
                    <h3>‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</h3>
                    <p>${error.message}</p>
                    <p><strong>–ú–æ–∂–ª–∏–≤—ñ –ø—Ä–∏—á–∏–Ω–∏:</strong></p>
                    <ul style="text-align: left; display: inline-block; margin: 10px 0;">
                        <li>Google –¢–∞–±–ª–∏—Ü—è –Ω–µ –º–∞—î –ø—É–±–ª—ñ—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É</li>
                        <li>–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π ID —Ç–∞–±–ª–∏—Ü—ñ</li>
                        <li>–õ–∏—Å—Ç "exchange" –Ω–µ —ñ—Å–Ω—É—î</li>
                        <li>–£ —Ç–∞–±–ª–∏—Ü—ñ –Ω–µ–º–∞—î –¥–∞–Ω–∏—Ö –∑ —Ä—è–¥–∫–∞ 2</li>
                        <li>–ü—Ä–æ–±–ª–µ–º–∏ –∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç-–∑'—î–¥–Ω–∞–Ω–Ω—è–º</li>
                    </ul>
                    <p><small>ID —Ç–∞–±–ª–∏—Ü—ñ: ${SPREADSHEET_ID}</small></p>
                `;
                lastUpdateEl.textContent = '–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è';
            }
        }

        function displayRates() {
            const tableBody = document.getElementById('ratesTableBody');
            tableBody.innerHTML = '';

            ratesData.forEach(rate => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td data-label="–í–∞–ª—é—Ç–∞">${escapeHtml(rate.currency)}</td>
                    <td data-label="–ö—É–ø—ñ–≤–ª—è"><span class="buy-rate">${escapeHtml(rate.buy.toString())}</span></td>
                    <td data-label="–ü—Ä–æ–¥–∞–∂"><span class="sell-rate">${escapeHtml(rate.sell.toString())}</span></td>
                `;

                tableBody.appendChild(row);
            });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
        function startAutoRefresh() {
            if (AUTO_REFRESH_INTERVAL > 0) {
                setInterval(loadRates, AUTO_REFRESH_INTERVAL * 60 * 1000);
                console.log(`–ê–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è —É–≤—ñ–º–∫–Ω–µ–Ω–æ: –∫–æ–∂–Ω—ñ ${AUTO_REFRESH_INTERVAL} —Ö–≤–∏–ª–∏–Ω`);
            } else {
                console.log('–ê–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–∏–º–∫–Ω–µ–Ω–æ');
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            loadRates();
            startAutoRefresh();
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∫ –≤–∫–ª–∞–¥–∫–µ
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden && AUTO_REFRESH_INTERVAL > 0) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–æ—à–ª–æ –ª–∏ –±–æ–ª—å—à–µ 2 –º–∏–Ω—É—Ç —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                const lastUpdate = document.getElementById('lastUpdate').textContent;
                if (!lastUpdate.includes('–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è') || 
                    (Date.now() - new Date(lastUpdate.split(': ')[1]).getTime() > 2 * 60 * 1000)) {
                    loadRates();
                }
            }
        });
    </script>
</body>
</html>
